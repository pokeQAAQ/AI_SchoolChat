# AI_SchoolChat

## 📁 知识库文件上传功能

本项目新增了基于Web的文件上传功能，用于构建本地知识库。

### 功能特点

- **文件存储**: 将文件保存到本地知识库文件夹，仅用于存储，不参与AI对话
- **支持格式**: .pdf, .doc, .docx, .md, .markdown, .txt
- **容量管理**: 
  - 默认总容量限制：1GB (1,073,741,824 bytes)
  - 默认单文件限制：10MB (10,485,760 bytes)
- **设备友好**: 针对Orange Pi Zero3等ARM Linux设备优化，采用流式上传减少内存占用
- **安全特性**: 文件名安全化、路径遍历防护、文件类型验证

### 使用方法

1. 启动上传服务器:
   ```bash
   cd test1
   python3 upload_server.py
   ```

2. 访问Web界面: `http://localhost:8080`

3. 在页面底部的"📁 上传本地知识库"部分：
   - 点击选择文件（支持多选）
   - 查看当前存储使用情况和进度条
   - 点击"📤 上传文件"按钮

### 配置选项

通过环境变量配置存储设置（参考 `.env.example`）：

```bash
# 知识库存储目录
KNOWLEDGE_BASE_DIR=./data/knowledge_base

# 总容量限制 (bytes)
KNOWLEDGE_BASE_MAX_BYTES=1073741824

# 单文件大小限制 (bytes)
KNOWLEDGE_BASE_MAX_FILE_BYTES=10485760
```

### API接口

- **GET /kb/usage**: 获取存储使用统计
- **POST /kb/upload**: 多文件上传接口

### 文件存储位置

上传的文件保存在：`./data/knowledge_base/` 目录下

### 测试验证

1. 上传几个不同格式的文件，验证它们出现在配置的文件夹中
2. 查看使用统计数字和进度条是否正确反映变化  
3. 尝试上传超出容量的大文件，确认显示明确的拒绝消息
4. 重启应用，确保目录自动创建且使用统计显示现有文件

AI校园智能小助手 - 支持语音对话和本地知识库文件上传

## 功能特性

### 核心功能
- 🗣️ 语音对话：支持语音输入和TTS语音回复
- 💬 文本聊天：支持文本对话交互
- 🧠 本地知识库：支持文本知识和文件知识库

### 知识库文件上传 (新功能)
- 📁 **文件上传**：支持将文档文件上传到本地知识库
- 📝 **支持格式**：.pdf, .doc, .docx, .md, .markdown, .txt
- 💾 **存储管理**：本地存储，支持容量限制和使用统计
- 🔒 **安全验证**：文件类型验证、大小限制、文件名清理
- 📊 **使用监控**：实时显示存储使用情况和容量进度条

## 环境配置

### 知识库文件上传配置
可以通过环境变量配置知识库文件上传功能：

```bash
# 知识库文件存储目录 (默认: ./data/knowledge_base)
export KNOWLEDGE_BASE_DIR="./data/knowledge_base"

# 知识库总容量限制 (字节，默认: 209715200 = 200MB)
export KNOWLEDGE_BASE_MAX_BYTES=209715200

# 单个文件大小限制 (字节，默认: 52428800 = 50MB)  
export KNOWLEDGE_BASE_MAX_FILE_BYTES=52428800
```

### 文件存储说明
- 📂 **存储位置**：文件保存在配置的知识库目录中
- 🚫 **仅存储**：上传的文件仅用于存储，不参与AI对话生成
- 🔄 **文件处理**：支持流式上传，对低内存设备友好
- 📏 **限制说明**：
  - 默认总容量限制：200MB
  - 默认单文件限制：50MB
  - 支持多文件同时上传

## 使用说明

### 启动上传服务器
```bash
cd test1
python3 upload_server.py
```

### 访问Web界面
- 本地访问：http://localhost:8080
- 移动设备：连接热点后访问 http://192.168.10.1:8080

### 使用文件上传功能
1. 在Web界面底部找到"📁 上传本地知识库"区域
2. 点击"选择文件"按钮选择要上传的文件
3. 查看存储使用情况和进度条
4. 点击"📤 上传文件"完成上传
5. 系统会显示上传结果和更新的使用统计

## 技术架构

- **前端**：HTML5 + CSS3 + JavaScript (移动端适配)
- **后端**：Flask Web框架
- **存储**：SQLite数据库 + 本地文件系统
- **部署**：适配Orange Pi Zero3 (ARM Linux)

## 目标设备

针对Orange Pi Zero3优化：
- 💾 流式文件上传，内存使用友好
- ⚡ 轻量级依赖，启动快速
- 🔧 ARM架构兼容性
